
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ü–æ–¥—Å–∫–∞–∑–∫–∞ –ú–ö–ë</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main>
    <h2>üîç –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ú–ö–ë-10</h2>
    <input type="text" id="mkbInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: J45" />
    <button onclick="–ø–æ–ª—É—á–∏—Ç—å()">üîé –ù–∞–π—Ç–∏</button>
    <div id="result" class="section" style="margin-top:15px;"></div>
  </main>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script>
  <script>
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    async function –ø–æ–ª—É—á–∏—Ç—å() {
      const input = document.getElementById('mkbInput').value.trim().toUpperCase();
      const resultBox = document.getElementById('result');
      resultBox.innerHTML = "‚è≥ –ü–æ–∏—Å–∫...";

      const doc = await db.collection("settings").doc("rules").get();
      const data = doc.data().data || [];
      const normalize = s => s.toString().replace(/\s+/g, "").replace(/[‚Äê‚Äë‚Äí‚Äì‚Äî‚Äï]/g, "-")
        .replace(/[\u200B-\u200D\uFEFF]/g, "").toUpperCase().trim();

      const –∫–æ–¥ = normalize(input);
      const —Ä–µ–∑—É–ª—å—Ç–∞—Ç = [];

      for (const –∑–∞–ø–∏—Å—å of data) {
        const raw = –∑–∞–ø–∏—Å—å["–ö–æ–¥ –ú–ö–ë-10"];
        const —Å–ø–∏—Å–æ–∫ = raw.split(",").map(s => normalize(s));
        for (const –æ–¥–∏–Ω of —Å–ø–∏—Å–æ–∫) {
          let —Å–æ–≤–ø–∞–¥–∞–µ—Ç = false;
          if (–æ–¥–∏–Ω.includes("-")) —Å–æ–≤–ø–∞–¥–∞–µ—Ç = isInRange(–∫–æ–¥, –æ–¥–∏–Ω);
          else if (/^[A-Z]\d{2}$/.test(–æ–¥–∏–Ω)) —Å–æ–≤–ø–∞–¥–∞–µ—Ç = isInRange(–∫–æ–¥, `${–æ–¥–∏–Ω}-${–æ–¥–∏–Ω}.9`);
          else —Å–æ–≤–ø–∞–¥–∞–µ—Ç = normalize(–æ–¥–∏–Ω) === –∫–æ–¥;

          if (—Å–æ–≤–ø–∞–¥–∞–µ—Ç) {
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç.push(–∑–∞–ø–∏—Å—å);
            break;
          }
        }
      }

      if (!—Ä–µ–∑—É–ª—å—Ç–∞—Ç.length) {
        resultBox.innerHTML = "<b>‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ</b>";
        return;
      }

      const –±–ª–æ–∫–∏ = —Ä–µ–∑—É–ª—å—Ç–∞—Ç.map(row =>
        `–ü–æ–≤–æ–¥ –æ–±—Ä–∞—â–µ–Ω–∏—è: <b>${row["–ü–æ–≤–æ–¥ –æ–±—Ä–∞—â–µ–Ω–∏—è"]}</b><br>–¢–∏–ø –æ–ø–ª–∞—Ç—ã: <b>${row["–¢–∏–ø –æ–ø–ª–∞—Ç—ã"]}</b>`);
      resultBox.innerHTML = –±–ª–æ–∫–∏.join("<hr>");
    }

    function isInRange(code, range) {
      const parse = s => {
        const m = s.match(/^([A-Z])(\d{2})(?:\.(\d))?$/);
        return m ? { letter: m[1], major: +m[2], minor: m[3] ? +m[3] : 0 } : null;
      };
      const [start, end] = range.includes("-") ? range.split("-") : [range, range];
      const a = parse(start), b = parse(end), x = parse(code);
      if (!a || !b || !x) return false;
      if (!start.includes(".")) a.minor = 0;
      if (!end.includes(".")) b.minor = 9;
      const idx = c => c.major * 10 + c.minor;
      return a.letter === x.letter && b.letter === x.letter && idx(x) >= idx(a) && idx(x) <= idx(b);
    }
  </script>
</body>
</html>
